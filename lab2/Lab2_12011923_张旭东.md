<h1 align = "center">Lab2 Fundamentals of Human Speech Production</h1>

<center>张旭东 12011923</center>

## 1.Introduction

​	The purpose of this lab is to continue learn MATLAB functionality for speech processing and test the effect of digital filtering on speech perception. In this experiment, several signal will be analyzed, including the phoneme, resonance peak and other parameters of each segment.

## 2.Lab result and analysis 

### 2.1 Problem1

​	The purpose of problem1 is to learn and understand the process of  `segmentation and labeling` of speech using the principle of phonetic. 

​	After loading the speech file `s5.wav`, the sentence is: Oak is strong and also gives shade. The ARPAbet symbols and the IPA representation are shown as follow:

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230228194229380.png" alt="image-20230228194229380" style="zoom:67%;" />

<div align = 'center'><b>Fig.1 ARPAbet symbols and IPA representation</div>

​	Then, A function `PlotAudioFile` used in Lab1 is used again to plot the sound and label it. The result is as follows:

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230228200407445.png" alt="image-20230228200407445" style="zoom: 50%;" />

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230228201052593.png" alt="image-20230228201052593" style="zoom:50%;" />

<div align = 'center'><b>Fig.2 labeled waveform</div>

​	What's more, We also use `colea` to plot and label each phoneme. The label result is as follows:

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230228201608313.png" alt="image-20230228201608313" style="zoom:50%;" />

<div align = 'center'><b>Fig.3 labeled waveform with colea</div>

​	Then, we use `colea` to zero out the vowel regions of the sentence (replace the speech waveform with zero-valued samples during the vowel regions) for `colea`'s convenience. The result is as below:

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301102914410.png" alt="image-20230301102914410" style="zoom:50%;" />

<div align = 'center'><b>Fig.4 zero out the vowel regions without deleting diphthongs 'EY'</div>

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301103523633.png" alt="image-20230301103523633" style="zoom:50%;" />

<div align = 'center'><b>Fig.5 zero out the vowel regions with deleting diphthongs 'EY'</div>

​	It is impossible to understand the meaning of the speech after hearing the speech which is handled by zeroing out the vowel region, which coincides with the theory in the lecture notes. Vowel has a big influence on hearing and understanding the the meaning of the speech.

​	Then, zeroing out all the consonant regions of the sentence is done.

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301104242963.png" alt="image-20230301104242963" style="zoom:50%;" />

<div align = 'center'><b>Fig.6 zero out the consonant regions </div>

​	It is obvious that the latter sounds much better than the former and the information and meaning transferred by the speech can be generally understood, which implies consonant has little influence on hearing and understanding the the meaning of the speech.

​	Through the above comparison, the sentence without consonant has an advantage than that without vowel in conveying information.  

### 2.2 Problem2

​	In this problem, the difference for peak of spectral envelope for several vowel sounds will be discussed and the difference of formant frequencies extracted from `FFT` and `Praat` analyses will be compared.

​	First, three vowels `/a/`, `/i/`, `/u/` , whose sample rate are $1.6$ `kHz` are generated by using function `audiorecorder`. 

```matlab
recorder=audiorecorder(16000,16,1);
%记录/a/
disp('start recording');
recordblocking(recorder,1);
disp('end recording');
a=getaudiodata(recorder);
filename='a.wav';
audiowrite(filename,a,16000);

%记录/i/
disp('start recording');
recordblocking(recorder,1);
disp('end recording');
i=getaudiodata(recorder);
filename='i.wav';
audiowrite(filename,i,16000);

%记录/u/
disp('start recording');
recordblocking(recorder,1);
disp('end recording');
u=getaudiodata(recorder);
filename='u.wav';
audiowrite(filename,u,16000);

```

​	Then, the waveform and spectrum of them are plotted.

<center class="half">    
    <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301110559068.png" alt="image-20230301110559068" style="zoom:100%;"width="300"/>    
    <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301110643784.png" alt="image-20230301110643784" style="zoom:100%;" width="300"/> 
</center

<div align = 'center'><b>Fig.7 waveform and spectrum </div>	

​	To extract formant frequencies from FFT, the range of `x-axis` is set to $[0,5000]$ because the maximum frequency of a male voice will not exceed 5,000 Hz.

<center class="half">    
    <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301111428826.png" alt="image-20230301111428826" style="zoom:100%;"width="300"/>    
    <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301111619982.png" alt="image-20230301111619982" style="zoom:100%;" width="300"/> 
</center

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301111802474.png" alt="image-20230301111802474" style="zoom:50%;" />

<div align = 'center'><b>Fig.8 spectra analysis of sound </div>	

​	Then, we use `Praat` to analysis the three vowels to get the formant frequencies. To reduce the error, `Praat` don't record again.

<center class="half">    
    <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301112307276.png" alt="image-20230301112307276" style="zoom:100%;"width="300"/>    
    <img  src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301112342889.png" alt="image-20230301112342889" style="zoom:100%;" width="300"/> 
</center

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301112400764.png" alt="image-20230301112400764" style="zoom: 40%;" />

<div align = 'center'><b>Fig.9 analysis from Praat </div>	

The formant frequencies extracted from `FFT` and `Praat` analysis are listed as below:

|      |        | F0    | f1    | f2   | f3   | f4   |
| ---- | ------ | ----- | ----- | ---- | ---- | ---- |
| a    | MATLAB | 638   | 1152  | 2536 | 3626 | 4646 |
|      | Praat  | 657.6 | 1141  | 2590 | 3586 | 4794 |
| i    | MATLAB | 257   | 1836  | 2605 | 4149 |      |
|      | Praat  | 265.1 | 1865  | 2620 | 4100 |      |
| u    | MATLAB | 368   | 980   | 2199 | 3870 | 4878 |
|      | Praat  | 347   | 908.3 | 2280 | 3777 | 4806 |

​	It can't be ignored is that the value of formant frequency extracted from `FFT` is not very precise because the spectrum in MATLAB is continuous and it is hard to find out exactly where the formant frequencies are.

​	Through the comparison of the value in the table, the formant frequencies extracted from `FFT` and `Praat` analysis  are a little different. The reason is that the values of formant frequencies changes with time but we only select one segment to analyze.

### 2.3 Problem3

​	In this problem, the effect of filter will be discussed again and the process of designing a filter will be used again.

​	First, we filter the speech file `test_16k.wav` to bandwidths of $5.5$, $4$ and $3.2$ `kHz` using the function `butter`. 

<center class="half">    
    <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301114021478.png" alt="image-20230301114021478" style="zoom:100%;"width="300"/>    
    <img  src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301114041857.png" alt="image-20230301114041857" style="zoom:100%;" width="300"/> 
</center

<div align = 'center'><b>Fig.10 waveform and spectrum </div>	

​	From the second picture, it is obvious that the spectrum of filtered signal with bandwidth of $5.5$ `kHz` has components in the frequency which exceeds $5.5$ `kHZ`. So as the rest two. The reason is that the magnitude response of `butterworth` filter has ripples in the frequency which exceeds $5.5$ `kHz`. The details of `butterworth` filter have been discussed in report of `Lab1`.

​	After hearing the three results, it is obvious that three kinds of audio with different bandwidth are easy to understand. However, the smaller the cut-off frequency of low-pass filter, the more blurred the sound and the volume decreases due to the lowpass filter reduces the amplitude of the signal slightly.

​	Then, a function `fdatool` is used to design a digital high-pass filter, with appropriate cutoff frequencies to attenuated $60$ `kHz` components by at least $40$ dB. 

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301115418947.png" alt="image-20230301115418947" style="zoom:50%;" />

<div align = 'center'><b>Fig.11 high-pass filter design </div>

​	The code of the digital high-pass filter is below:

```matlab
function Hd = highpass
%HIGHPASS 返回离散时间滤波器对象。

% MATLAB Code
% Generated by MATLAB(R) 9.10 and Signal Processing Toolbox 8.6.
% Generated on: 28-Feb-2023 22:42:41

% Equiripple Highpass filter designed using the FIRPM function.

% All frequency values are in Hz.
Fs = 16000;  % Sampling Frequency

Fstop = 60;              % Stopband Frequency
Fpass = 80;              % Passband Frequency
Dstop = 0.0001;          % Stopband Attenuation
Dpass = 0.057501127785;  % Passband Ripple
dens  = 20;              % Density Factor

% Calculate the order from the parameters using FIRPMORD.
[N, Fo, Ao, W] = firpmord([Fstop, Fpass]/(Fs/2), [0 1], [Dstop, Dpass]);

% Calculate the coefficients using the FIRPM function.
b  = firpm(N, Fo, Ao, W, {dens});
Hd = dfilt.dffir(b);

% [EOF]
```

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20230301115737822.png" alt="image-20230301115737822" style="zoom:50%;" />

<div align = 'center'><b>Fig.12 filtered speech signal </div>

​	Compared to the original signal, there is a little difference between them in hearing. This is because the components between $-60$ `kHz` and $60$ `kHz` take relatively small part.

## 3.Conclusion

​	In this lab, the most important harvest is to have learned how to use `colea` and `Praat` to analysis and operate speech file. Besides, the influence of vowel and consonant on hearing and understanding the meaning of sentence has been discussed. What's more, the method of extracting formant frequencies is so convenient that it is easy to master.